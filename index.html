<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Thi trắc nghiệm Pháp luật</title>
<style>
body{font-family:Arial;background:#f2f4f7;padding:20px}
.container{max-width:1000px;margin:auto;background:#fff;padding:20px;border-radius:8px}
.hidden{display:none}
button{padding:8px 16px;margin:5px}
.timer{color:red;font-weight:bold}
.progress{margin:10px 0}
.done{color:green}
.todo{color:#999}
</style>
</head>

<body>
<div class="container">

<div id="start">
<h2>Nhập tên người làm bài</h2>
<input id="username" placeholder="Họ và tên" style="padding:8px;width:300px">
<br><br>
<button onclick="startQuiz()">Bắt đầu</button>
</div>

<div id="quiz" class="hidden">
<div class="progress">
<b id="step"></b> |
Hoàn thành: <span id="percent"></span>% |
⏱ Tổng thời gian: <span class="timer" id="totalTime">0</span>s |
⏳ Câu này: <span class="timer" id="time">30</span>s
</div>

<h3 id="qtext"></h3>
<div id="answers"></div>

<button id="nextBtn" class="hidden" onclick="nextQuestion()">Câu tiếp theo</button>
</div>

<div id="result" class="hidden"></div>

</div>

<script>
/* ====== CÂU HỎI (rút gọn demo – bạn giữ nguyên phần này như bản trước) ====== */
let rawQuestions = [
{q:"Đâu không phải là nguyên tắc tổ chức và hoạt động của bộ máy Nhà nước Cộng hòa xã hội chủ nghĩa Việt Nam?",
a:["Tập trung dân chủ","Đảng lãnh đạo","Công khai minh bạch","Bình đẳng, đoàn kết dân tộc"],c:2},
{q:"Cơ quan quyền lực nhà nước cao nhất của nước Cộng hòa xã hội chủ nghĩa Việt Nam là:",
a:["Chính phủ","Chủ tịch nước","Quốc hội","Bộ Chính trị"],c:2}
];

/* ====== TRỘN CÂU + ĐÁP ÁN ====== */
function shuffle(arr){
return arr.map(v=>({v,sort:Math.random()}))
.sort((a,b)=>a.sort-b.sort).map(({v})=>v);
}
let questions = shuffle(rawQuestions).map(q=>{
let ans = q.a.map((text,i)=>({text,i}));
ans = shuffle(ans);
return {q:q.q,a:ans.map(x=>x.text),c:ans.findIndex(x=>x.i===q.c)};
});

/* ====== BIẾN ====== */
let index=0, score=0, timer, timeLeft=30, total=0;
let answers=[], username="";
let startTime;

/* ====== KHỞI ĐỘNG ====== */
function startQuiz(){
username=document.getElementById("username").value.trim();
if(!username){alert("Vui lòng nhập tên");return;}
startTime=Date.now();
document.getElementById("start").classList.add("hidden");
document.getElementById("quiz").classList.remove("hidden");
loadQuestion();
}

/* ====== LOAD CÂU ====== */
function loadQuestion(){
timeLeft=30;
document.getElementById("time").innerText=timeLeft;
document.getElementById("nextBtn").classList.add("hidden");
document.getElementById("answers").innerHTML="";
document.getElementById("qtext").innerText=`Câu ${index+1}: ${questions[index].q}`;
document.getElementById("step").innerText=`Câu ${index+1}/${questions.length}`;
document.getElementById("percent").innerText=Math.round(index/questions.length*100);

questions[index].a.forEach((ans,i)=>{
let btn=document.createElement("button");
btn.innerText=ans;
btn.onclick=()=>selectAnswer(i);
document.getElementById("answers").appendChild(btn);
});

timer=setInterval(()=>{
timeLeft--;
document.getElementById("time").innerText=timeLeft;
total=Math.floor((Date.now()-startTime)/1000);
document.getElementById("totalTime").innerText=total;
if(timeLeft===0){
clearInterval(timer);
}
},1000);
}

/* ====== CHỌN ĐÁP ÁN ====== */
function selectAnswer(i){
clearInterval(timer);
answers[index]=i;
document.getElementById("nextBtn").classList.remove("hidden");
saveProgress();
}

/* ====== CÂU TIẾP ====== */
function nextQuestion(){
if(answers[index]===undefined){alert("Chưa chọn đáp án");return;}
index++;
if(index<questions.length){
loadQuestion();
}else{
showResult();
}
}

/* ====== KẾT QUẢ ====== */
function showResult(){
document.getElementById("quiz").classList.add("hidden");
let html=`<h2>KẾT QUẢ</h2>
<p><b>Người làm bài:</b> ${username}</p>
<p><b>Thời gian:</b> ${total}s</p>`;
let correct=[], wrong=[];
questions.forEach((q,i)=>{
if(answers[i]===q.c){score++;correct.push(`Câu ${i+1}: ${q.q}`);}
else{wrong.push(`Câu ${i+1}: ${q.q} (Đáp án đúng: ${String.fromCharCode(65+q.c)})`);}
});
html+=`<p><b>Đúng:</b> ${score}/${questions.length}</p>`;
html+=`<h3 class="done">Câu đúng</h3><ul>${correct.map(x=>`<li>${x}</li>`).join("")}</ul>`;
html+=`<h3 class="todo">Câu sai</h3><ul>${wrong.map(x=>`<li>${x}</li>`).join("")}</ul>`;
html+=`<button onclick="location.reload()">Làm lại</button>`;
document.getElementById("result").innerHTML=html;
document.getElementById("result").classList.remove("hidden");
saveHistory();
}

/* ====== LƯU TẠM ====== */
function saveProgress(){
localStorage.setItem("quizProgress",JSON.stringify({username,index,answers,startTime}));
}
function saveHistory(){
let h=JSON.parse(localStorage.getItem("quizHistory")||"[]");
h.push({username,score,time:total,date:new Date().toLocaleString()});
localStorage.setItem("quizHistory",JSON.stringify(h));
}
</script>
</body>
</html>
